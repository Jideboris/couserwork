SSL Protocol flow using NodeJS and RSA / AES encryption
=======================================================

Description
------------
This respresent the client side of SSL messages exchange protocol flow between server and client using simple
Nodejs express framework, crypto,pem,path,compression,http,cors,cookie-parser,body-parser,x509,http-postand,jade, fs npm libraries.


Requirements
------------
nodejs 9.3.0 and >  download fromm https://nodejs.org/en/
Visual Studio Code download from https://code.visualstudio.com/download
Mac please.

Folder structure
----------------
assets --->keys ---> Consists of stored certificate from server,generated symmetric key and hmac key.

utility 
-------
The folder consists of three js files,which are rsa-wrapper.js, symmetricengine.js and util-processor.js

rsa-wrapper
-----------
It has a 'encrypt' function, the function is used to encrypt messages to be sent to server.

symmetricengine
---------------
1.This consists of two functions (encrypt and decrypt).Both functions used the sessioned symmetric key generated from the client.
2.The function encrypt by concatenating cipher text with Initialization vector IV (https://en.wikipedia.org/wiki/Initialization_vector) and HMAC of the ciphertext in order to check for its integrity.
3.The decrypt function is used to decrypt the ciphertext and computes new hmac.It then compares the new hmac length with decrypted hmac.If is not the same the message has been tampared with else it is intact.

util-processor
--------------
It consists of 4 functions,which are:
postencryptedsessionedkeywithserverpublickey
1. It posts ciphertext consists of session symmetric key and hmac key generated by client,encrypted with server's public key to the server.

getcontent
1. It requests digital certificate from the server
2. It writes the certificate into a temp local file on the client side
3. It calls 'validateCert' function in order to validate the certificate by checking for its expiry date.
4. If certificate is valid,it calls 'generateSymmetricKey' to generate symmetric key to be used for the session and another for hmac hash.
5. It writes both keys to local files.
6. It concatenates the keys and current time as timestamp
7. It encrypts the concatenated value with server's public key and send to the server
8. It receives the encrypted response message from the server.Server encrypted the message with the symmetric key and hmac key.
9. It decrypts the message with its copy of symmetric key and hmac key.
10. It render the response unto the browser.

validateCert
1. Check the expiry date on the certificate 'NotAfter' and 'NotBefore' to ensure it is valid.If not valid processes stopped.

generateSymmetricKey
1. It is used to generate Symmetric key and HMAC key.

views
-----
It consists of 2 browser pages using jade engine.Home.jade and message.jade.

home.jade
---------
landing page with my details and short instruction on what to do to proceed.

message.jade
------------
Final page on getting message response from the server.It has a back button to go back to home page.

client.js
---------
It has all the setup with express and two routers

This is the default location or landing page.'/home'
app.get('/home', function (req, res) {
    res.render('home', {
        title: 'Welcome',
        message: 'Please click on the button request content to see message from the server'
    });
});
This is naavigate page to display server's message on content request. '/requestcontent'
app.post('/requestcontent', function (req, res) {
    processors.getcontent(req, res).then((resp) => {
        res.render('message', {
            message: resp
        });
    })

});

package.json
------------
it consists all installed libraries and versions.

Setup
-----
Please follow the steps below to start the server
1. Copy this project folder to a directory location of your choice (use MAC please)
2. Make sure node and visual studio code are installed,use the urls above to download them
3. User terminal command to access the directory i.e cd  and code . to open the project in the visual studio code automatically.
4. npm install
5. npm start
6. Should see 'Express client listening on port 8000'
7. Any issue delete the node_modules and package-lock.json and goto step 4.

Run
---
~~~~~~~~~~~~~~~~~~
npm start
~~~~~~~~~~~~~~~~~~
Starts web server on 3000 port.
Message displayed is 'Express client listening on port 3000'
